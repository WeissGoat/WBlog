<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ç™½å±±ç¾Š</title><link>https://WeissGoat.github.io/WBlog/</link><description>Recent content on ç™½å±±ç¾Š</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 05 Feb 2024 18:00:00 +0800</lastBuildDate><atom:link href="https://WeissGoat.github.io/WBlog/index.xml" rel="self" type="application/rss+xml"/><item><title>Lua GC</title><link>https://WeissGoat.github.io/WBlog/p/lua-gc/</link><pubDate>Mon, 05 Feb 2024 18:00:00 +0800</pubDate><guid>https://WeissGoat.github.io/WBlog/p/lua-gc/</guid><description>&lt;h1 id="lua-gc-ä¸‰è‰²æ ‡è®°å¢é‡å›æ”¶ä¸å†™å±éšœ"&gt;Lua GC ï¼šä¸‰è‰²æ ‡è®°ã€å¢é‡å›æ”¶ä¸å†™å±éšœ
&lt;/h1&gt;&lt;h2 id="ä»-stop-the-world-åˆ°å¢é‡"&gt;ä» Stop-the-World åˆ°å¢é‡
&lt;/h2&gt;&lt;h3 id="lua-50ç®€å•çš„ä»£ä»·"&gt;Lua 5.0ï¼šç®€å•çš„ä»£ä»·
&lt;/h3&gt;&lt;p&gt;åœ¨ Lua 5.0 æ—¶ä»£ï¼ŒGC ç®—æ³•éå¸¸æœ´ç´ ï¼š&lt;strong&gt;åŒå€é˜ˆå€¼ï¼Œå…¨é‡å›æ”¶&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘&lt;/strong&gt;ï¼šå½“å†…å­˜ä½¿ç”¨é‡è¾¾åˆ°ä¸Šæ¬¡ GC åçš„ä¸¤å€æ—¶ï¼Œè™šæ‹Ÿæœºæš‚åœæ‰€æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œè·‘ä¸€éå®Œæ•´çš„â€œæ ‡è®°-æ¸…é™¤â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åæœ&lt;/strong&gt;ï¼šè¿™å°±æ˜¯è‘—åçš„ &lt;strong&gt;Stop-the-World (STW)&lt;/strong&gt;ã€‚å¦‚æœä½ çš„ Lua å†…å­˜å ç”¨äº† 1GBï¼ŒGC è§¦å‘çš„é‚£ä¸€ç¬é—´ï¼Œæ•´ä¸ªæ¸¸æˆæˆ–æœåŠ¡å¯èƒ½ä¼šå¡é¡¿å‡ ç™¾æ¯«ç§’ç”šè‡³æ›´ä¹…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="lua-51ä¸‰è‰²å¢é‡æ ‡è®°tri-color-incremental-mark--sweep"&gt;Lua 5.1+ï¼šä¸‰è‰²å¢é‡æ ‡è®°ï¼ˆTri-color Incremental Mark &amp;amp; Sweepï¼‰
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†è§£å†³å¡é¡¿ï¼ŒLua 5.1 å¼•å…¥äº†å¢é‡ GCã€‚GC è¿‡ç¨‹ä¸ä¸šåŠ¡ä»£ç äº¤æ›¿è¿è¡Œã€‚&lt;/p&gt;
&lt;p&gt;ä¸ºäº†å®ç°â€œå¯ä¸­æ–­ã€å¯æ¢å¤â€çš„æ‰«æï¼ŒLua å¼•å…¥äº†&lt;strong&gt;ä¸‰è‰²æ ‡è®°æ³•&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h2 id="æ ¸å¿ƒç®—æ³•ä¸‰è‰²æ ‡è®°ä¸åŒç™½è®¾è®¡"&gt;æ ¸å¿ƒç®—æ³•ï¼šä¸‰è‰²æ ‡è®°ä¸åŒç™½è®¾è®¡
&lt;/h2&gt;&lt;p&gt;GC çš„æœ¬è´¨æ˜¯ä»æ ¹èŠ‚ç‚¹ï¼ˆ_Gã€Registryã€æ ˆï¼‰å‡ºå‘ï¼Œæ‰¾åˆ°æ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚åœ¨å¢é‡æ‰«æè¿‡ç¨‹ä¸­ï¼Œå¯¹è±¡è¢«æ ‡è®°ä¸ºä¸‰ç§é¢œè‰²ï¼š&lt;/p&gt;
&lt;h3 id="é¢œè‰²çš„å«ä¹‰"&gt;é¢œè‰²çš„å«ä¹‰
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;âšª ç™½è‰² (White)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šå½“å‰è¿˜æœªè¢« GC è®¿é—®åˆ°çš„å¯¹è±¡ï¼Œæˆ–è€…å·²æ­»äº¡çš„å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆå§‹çŠ¶æ€&lt;/strong&gt;ï¼šæ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡é»˜è®¤ä¸ºç™½è‰²ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“å±€&lt;/strong&gt;ï¼šå¦‚æœ GC ç»“æŸåè¿˜æ˜¯ç™½è‰²ï¼Œè¯´æ˜ä¸å¯è¾¾ï¼Œ&lt;strong&gt;å›æ”¶&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;âš« é»‘è‰² (Black)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼š&lt;strong&gt;å·²æ‰«æå®Œæ¯•&lt;/strong&gt;ã€‚è¯¥å¯¹è±¡åŠå…¶å¼•ç”¨çš„æ‰€æœ‰å­å¯¹è±¡éƒ½å·²ç»è¢«è®¿é—®è¿‡äº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹æ€§&lt;/strong&gt;ï¼šGC è¿™ä¸€è½®ä¸ä¼šå†å›å¤´çœ‹å®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ğŸ”˜ ç°è‰² (Gray)&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼š&lt;strong&gt;å¾…å¤„ç†&lt;/strong&gt;ã€‚è¯¥å¯¹è±¡å·²è¢«è®¿é—®ï¼ˆä»ç™½è‰²å˜æˆäº†ç°è‰²ï¼‰ï¼Œä½†å®ƒå¼•ç”¨çš„å­å¯¹è±¡è¿˜æ²¡æ‰«æå®Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä½œç”¨&lt;/strong&gt;ï¼šç°è‰²æ˜¯å½“å‰æ‰«æçš„è¾¹ç¼˜ï¼ˆFrontierï¼‰ï¼Œä¿å­˜åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å·§å¦™çš„åŒç™½è®¾è®¡-the-two-whites"&gt;å·§å¦™çš„â€œåŒç™½â€è®¾è®¡ (The Two Whites)
&lt;/h3&gt;&lt;p&gt;æˆ‘åœ¨ç ”ç©¶æºç æ—¶å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç»†èŠ‚ï¼šLua çš„ç™½è‰²å…¶å®ç»†åˆ†ä¸º &lt;strong&gt;White1&lt;/strong&gt; å’Œ &lt;strong&gt;White2&lt;/strong&gt;ã€‚è¿™æ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;åœºæ™¯&lt;/strong&gt;ï¼š GC æ ‡è®°é˜¶æ®µå·²ç»å¿«ç»“æŸäº†ï¼ˆå¤§éƒ¨åˆ†æ˜¯é»‘è‰²ï¼‰ï¼Œæ­¤æ—¶ä¸šåŠ¡ä»£ç çªç„¶åˆ›å»ºäº†ä¸€ä¸ªæ–°å¯¹è±¡ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ–°å¯¹è±¡é»˜è®¤æ˜¯&lt;strong&gt;ç™½è‰²&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä¸åŠ åŒºåˆ†ï¼Œåœ¨æ¥ä¸‹æ¥çš„â€œæ¸…é™¤é˜¶æ®µâ€ï¼ŒGC ä¼šè®¤ä¸ºè¿™ä¸ªç™½è‰²çš„æ–°å¯¹è±¡æ˜¯â€œæ²¡è¢«å¼•ç”¨çš„åƒåœ¾â€å¹¶æŠŠå®ƒå›æ”¶æ‰â€”â€”&lt;strong&gt;è¿™ä¼šå¯¼è‡´ä¸¥é‡ Bug&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;è§£å†³æ–¹æ¡ˆ&lt;/strong&gt;ï¼š Lua ä½¿ç”¨ä¸€ä¸ªå…¨å±€çš„ä½æ©ç  &lt;code&gt;CurrentWhite&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æœ¬è½® GC&lt;/strong&gt;ï¼šåªå›æ”¶æ ‡è®°ä¸ºâ€œæ—§ç™½è‰²â€çš„å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ–°åˆ›å»ºå¯¹è±¡&lt;/strong&gt;ï¼šæ ‡è®°ä¸ºâ€œæ–°ç™½è‰²â€ï¼ˆCurrentWhiteï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»“æœ&lt;/strong&gt;ï¼šæ–°å¯¹è±¡åœ¨æœ¬è½® GC ä¸­è¢«è§†ä¸ºâ€œå®‰å…¨â€ï¼Œç•™åˆ°ä¸‹ä¸€è½®å†å¤„ç†ã€‚åœ¨æ¸…é™¤é˜¶æ®µç»“æŸåï¼ŒLua ä¼šè½®è½¬ &lt;code&gt;CurrentWhite&lt;/code&gt; çš„å€¼ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="çŠ¶æ€æœºçš„æµè½¬gc-çš„ç”Ÿå‘½å‘¨æœŸ"&gt;çŠ¶æ€æœºçš„æµè½¬ï¼šGC çš„ç”Ÿå‘½å‘¨æœŸ
&lt;/h2&gt;&lt;p&gt;Lua çš„å¢é‡ GC æ˜¯é€šè¿‡ä¸€ä¸ªçŠ¶æ€æœºé©±åŠ¨çš„ã€‚æ¯æ¬¡è°ƒç”¨ &lt;code&gt;luaC_step&lt;/code&gt;ï¼ŒGC å°±ä¼šå‘å‰æ¨è¿›ä¸€æ­¥ã€‚ä»¥ä¸‹æ˜¯ä¸»è¦çš„é˜¶æ®µï¼š&lt;/p&gt;
&lt;h3 id="-gcspause-æš‚åœåˆå§‹åŒ–"&gt;â‘  GCSpause (æš‚åœ/åˆå§‹åŒ–)
&lt;/h3&gt;&lt;p&gt;GC çš„èµ·ç‚¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;å°†æ ¹èŠ‚ç‚¹ï¼ˆä¸»çº¿ç¨‹ã€å…¨å±€è¡¨ _Gã€Registry ç­‰ï¼‰æ ‡è®°ä¸º&lt;strong&gt;ç°è‰²&lt;/strong&gt;ï¼Œå¹¶åŠ å…¥ç°è‰²é“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;æ­¤æ—¶ï¼Œé€šè¿‡æ ¹èŠ‚ç‚¹çš„ä¸€æ³¢æ“ä½œï¼Œæˆ‘ä»¬æœ‰äº†ç¬¬ä¸€æ‰¹å¾…æ‰«æçš„ç°è‰²å¯¹è±¡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-gcspropagate-ä¼ æ’­---æœ€è€—æ—¶çš„é˜¶æ®µ"&gt;â‘¡ GCSpropagate (ä¼ æ’­ - æœ€è€—æ—¶çš„é˜¶æ®µ)
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯â€œå¢é‡â€ä½“ç°æœ€æ˜æ˜¾çš„åœ°æ–¹ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;ï¼šä»ç°è‰²é“¾è¡¨ä¸­å¼¹å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå°†å…¶æ ‡è®°ä¸º&lt;strong&gt;é»‘è‰²&lt;/strong&gt;ï¼Œç„¶åéå†å®ƒå¼•ç”¨çš„æ‰€æœ‰å­å¯¹è±¡ï¼š&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯ç™½è‰²ï¼Œå°†å…¶æŸ“æˆ&lt;strong&gt;ç°è‰²&lt;/strong&gt;å¹¶åŠ å…¥é“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ§åˆ¶&lt;/strong&gt;ï¼šè¿™ä¸ªè¿‡ç¨‹ä¸æ˜¯ä¸€æ¬¡æ€§åšå®Œçš„ï¼Œè€Œæ˜¯å— &lt;code&gt;gcstepmul&lt;/code&gt; æ§åˆ¶ï¼Œæ¯æ¬¡åªå¤„ç†ä¸€éƒ¨åˆ†å°±æš‚åœï¼ŒæŠŠ CPU è®©ç»™ä¸šåŠ¡é€»è¾‘ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-gcsatomic-åŸå­é˜¶æ®µ---å¿…é¡»ä¸€æ¬¡åšå®Œ"&gt;â‘¢ GCSatomic (åŸå­é˜¶æ®µ - å¿…é¡»ä¸€æ¬¡åšå®Œ)
&lt;/h3&gt;&lt;p&gt;è¿™æ˜¯è¿™ä¸€è½® GC ä¸­å”¯ä¸€éœ€è¦ Stop-the-World çš„æ—¶åˆ»ï¼Œä½†é€šå¸¸å¾ˆå¿«ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šå› ä¸º Propagate é˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œä¸šåŠ¡ä»£ç å¯èƒ½åœ¨æ­¤æœŸé—´ä¿®æ”¹äº†å¼•ç”¨ï¼ˆæ¯”å¦‚æŠŠä¸€ä¸ªç™½è‰²å¯¹è±¡èµ‹å€¼ç»™äº†ä¸€ä¸ªå·²ç»é»‘è‰²çš„ Tableï¼‰ã€‚å¦‚æœä¸ä¿®æ­£ï¼Œé‚£ä¸ªç™½è‰²å¯¹è±¡ä¼šè¢«è¯¯åˆ ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;é‡æ–°éå†â€œç°åå•â€ï¼ˆGrayAgainï¼Œç”±å†™å±éšœäº§ç”Ÿï¼Œè¯¦è§ä¸‹æ–‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;æ‰«æå¼±å¼•ç”¨è¡¨ï¼ˆWeak Tablesï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å®Œæˆæ‰€æœ‰å‰©ä½™çš„æ ‡è®°å·¥ä½œã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="-gcssweepstring-å­—ç¬¦ä¸²æ¸…ç†"&gt;â‘£ GCSsweepstring (å­—ç¬¦ä¸²æ¸…ç†)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šLua çš„çŸ­å­—ç¬¦ä¸²æ˜¯å•ç‹¬ç®¡ç†çš„ï¼ˆé€šå¸¸å­˜å‚¨åœ¨å…¨å±€å“ˆå¸Œè¡¨ä¸­ï¼‰ã€‚å› ä¸ºå­—ç¬¦ä¸²æ²¡æœ‰å­å¼•ç”¨ï¼Œæ¸…ç†éå¸¸å¿«ï¼Œç›´æ¥ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤æœªæ ‡è®°çš„å­—ç¬¦ä¸²ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-gcssweep-æ™®é€šå¯¹è±¡æ¸…ç†"&gt;â‘¤ GCSsweep (æ™®é€šå¯¹è±¡æ¸…ç†)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;ï¼šéå†æ‰€æœ‰ GCObject é“¾è¡¨ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯&lt;strong&gt;é»‘è‰²&lt;/strong&gt;ï¼šè¯´æ˜æ´»ç€ï¼Œé‡ç½®ä¸ºå½“å‰ç™½è‰²ï¼ˆä¸ºä¸‹ä¸€è½®åšå‡†å¤‡ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœæ˜¯&lt;strong&gt;æ—§ç™½è‰²&lt;/strong&gt;ï¼šè¯´æ˜æ­»äº†ï¼Œ&lt;strong&gt;free&lt;/strong&gt; æ‰å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="-gcsfinalize-ç»ˆç»“"&gt;â‘¥ GCSfinalize (ç»ˆç»“)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;å¤„ç†æ‰€æœ‰å®ç°äº† &lt;code&gt;__gc&lt;/code&gt; å…ƒæ–¹æ³•çš„ Userdataã€‚è¿™äº›å¯¹è±¡ä¸ä¼šç«‹å³é‡Šæ”¾ï¼Œè€Œæ˜¯ä¼šè¢«æ”¾å…¥ä¸€ä¸ªå•ç‹¬çš„åˆ—è¡¨ï¼Œç­‰å¾…è™šæ‹Ÿæœºè°ƒç”¨å®ƒä»¬çš„ææ„å‡½æ•°ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="å¹¶å‘ä¸‹çš„é»‘æŒ‡å‘ç™½ä¸å†™å±éšœ"&gt;å¹¶å‘ä¸‹çš„â€œé»‘æŒ‡å‘ç™½â€ä¸å†™å±éšœ
&lt;/h2&gt;&lt;p&gt;åœ¨ &lt;code&gt;GCSpropagate&lt;/code&gt; é˜¶æ®µï¼ŒGC å’Œä¸šåŠ¡é€»è¾‘æ˜¯äº¤æ›¿è¿è¡Œçš„ã€‚è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªä¸¥é‡çš„&lt;strong&gt;æ•°æ®ç«äº‰&lt;/strong&gt;é—®é¢˜ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;é—®é¢˜åœºæ™¯&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;GC æ ‡è®°äº† Table A ä¸º&lt;strong&gt;é»‘è‰²&lt;/strong&gt;ï¼ˆè®¤ä¸º A å·²ç»æ‰«æå®Œäº†ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;ä¸šåŠ¡ä»£ç æ‰§è¡Œ &lt;code&gt;A.x = B&lt;/code&gt;ï¼Œå…¶ä¸­ B æ˜¯ä¸€ä¸ª&lt;strong&gt;ç™½è‰²&lt;/strong&gt;å¯¹è±¡ã€‚&lt;/li&gt;
&lt;li&gt;å› ä¸º A å·²ç»æ˜¯é»‘è‰²ï¼ŒGC ä¸ä¼šå†æ‰«æå®ƒã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åæœ&lt;/strong&gt;ï¼šB ä½œä¸ºä¸€ä¸ªè¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå´å› ä¸ºæ²¡è¢«æ‰«æåˆ°ï¼Œä¿æŒç™½è‰²ã€‚åœ¨æ¸…é™¤é˜¶æ®µï¼ŒB ä¼šè¢«å½“åƒåœ¾å›æ”¶ï¼Œå¯¼è‡´ &lt;code&gt;A.x&lt;/code&gt; å˜æˆäº†é‡æŒ‡é’ˆï¼&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="è§£å†³æ–¹æ¡ˆå†™å±éšœ-write-barrier"&gt;è§£å†³æ–¹æ¡ˆï¼šå†™å±éšœ (Write Barrier)
&lt;/h3&gt;&lt;p&gt;ä¸ºäº†ç»´æŠ¤**â€œé»‘è‰²å¯¹è±¡ä¸èƒ½æŒ‡å‘ç™½è‰²å¯¹è±¡â€**è¿™ä¸€ä¸å˜é‡ï¼ˆInvariantï¼‰ï¼ŒLua åœ¨æ¯æ¬¡ä¿®æ”¹å¼•ç”¨ï¼ˆtable set/assignmentï¼‰æ—¶ï¼Œä¼šè§¦å‘å†™å±éšœã€‚&lt;/p&gt;
&lt;p&gt;å†™å±éšœæœ‰ä¸¤ç§ä¸»è¦å½¢å¼ï¼š&lt;/p&gt;
&lt;h4 id="1-å‰è¿›å±éšœ-forward-barrier---æŠŠç™½è‰²æŸ“ç°"&gt;1. å‰è¿›å±éšœ (Forward Barrier) - &amp;ldquo;æŠŠç™½è‰²æŸ“ç°&amp;rdquo;
&lt;/h4&gt;&lt;p&gt;å¦‚æœä½ æŠŠç™½è‰²å¯¹è±¡ B èµ‹ç»™é»‘è‰²å¯¹è±¡ Aï¼Œå±éšœä¼šç«‹å³æŠŠ &lt;strong&gt;B æŸ“æˆç°è‰²&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ„ä¹‰&lt;/strong&gt;ï¼šæ—¢ç„¶ A å¼•ç”¨äº† Bï¼Œé‚£ B è‚¯å®šæ˜¯æœ‰ç”¨çš„ï¼Œèµ¶ç´§æŠŠ B æ‹‰è¿›å¾…æ‰«ææ¸…å•ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äºå°†æ–°å¯¹è±¡èµ‹å€¼ç»™è€å¯¹è±¡æ—¶ã€‚ç”¨äº Closure (Upvalues)ã€Userdata ç­‰ã€‚å› ä¸ºè¿™äº›å¯¹è±¡é€šå¸¸ä¸åƒ Table é‚£æ ·é¢‘ç¹ä¿®æ”¹å¼•ç”¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="2-åé€€å±éšœ-backward-barrier---æŠŠé»‘è‰²å›é€€å˜ç°"&gt;2. åé€€å±éšœ (Backward Barrier) - &amp;ldquo;æŠŠé»‘è‰²å›é€€å˜ç°&amp;rdquo;
&lt;/h4&gt;&lt;p&gt;å¦‚æœä½ æŠŠç™½è‰²å¯¹è±¡ B èµ‹ç»™é»‘è‰²å¯¹è±¡ Aï¼Œå±éšœæŠŠ &lt;strong&gt;A å˜å›ç°è‰²&lt;/strong&gt;ï¼Œæ‰”è¿› &lt;code&gt;grayagain&lt;/code&gt; åˆ—è¡¨ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ„ä¹‰&lt;/strong&gt;ï¼šA ä½ è™½ç„¶æ‰«è¿‡äº†ï¼Œä½†ä½ ç°åœ¨åˆæœ‰äº†æ–°æ¬¢ï¼ŒGC ç¨åå¾—å›å¤´å†æŸ¥ä½ ä¸€æ¬¡ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åº”ç”¨&lt;/strong&gt;ï¼šé€šå¸¸ç”¨äº &lt;code&gt;Table&lt;/code&gt; ç­‰å®¹å™¨ã€‚è¿™æ˜¯å› ä¸º Table å®¹æ˜“é¢‘ç¹å˜åŠ¨ï¼Œå¦‚æœç”¨å‰è¿›å±éšœï¼ˆæŠŠå­å¯¹è±¡å˜ç°ï¼‰ï¼Œä¸‹æ¬¡ Table å†å˜åŠ¨æ—¶åˆè¦è§¦å‘å±éšœï¼›è€ŒæŠŠ Table å˜ç°åï¼Œå®ƒå°±ç•™åœ¨ Gray é“¾è¡¨ä¸­ï¼Œä¹‹åå†å¾€é‡Œé¢å¡ç™½è‰²å¯¹è±¡å°±ä¸éœ€è¦è§¦å‘å±éšœäº†ï¼ˆå› ä¸ºçˆ¶å¯¹è±¡å·²ç»æ˜¯ç°çš„äº†ï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="æºç çª¥æ¢"&gt;æºç çª¥æ¢
&lt;/h3&gt;&lt;p&gt;è®©æˆ‘ä»¬çœ‹çœ‹ Lua å†…éƒ¨å® &lt;code&gt;luaC_barrier&lt;/code&gt; çš„ç®€åŒ–é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;/* ä¼ªä»£ç é€»è¾‘ï¼šå†™å±éšœ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;#define luaC_barrier(L, p, v) { \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* p æ˜¯çˆ¶å¯¹è±¡(Table)ï¼Œv æ˜¯å­å¯¹è±¡(Value) */ \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; if (isblack(p) &amp;amp;&amp;amp; iswhite(v)) { \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* è§¦å‘å±éšœï¼šé»‘è‰²æŒ‡å‘äº†ç™½è‰² */ \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; luaC_barrier_(L, obj2gco(p), obj2gco(v)); \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; } \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;void luaC_barrier_ (lua_State *L, GCObject *p, GCObject *v) {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* ä¿æŒé»‘ç™½ä¸å˜æ€§ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; if (isdead(L, v)) return; // å·²ç»æ­»çš„ä¸ç®¡
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; // ç­–ç•¥ï¼šé€šå¸¸æ˜¯å°† v (å­å¯¹è±¡) æ ‡ç° (Forward Barrier)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; // æˆ–è€…å°† p (çˆ¶å¯¹è±¡) æ”¾å…¥ grayagain åˆ—è¡¨ (Backward Barrier)
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; reallymarkobject(L, v);
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;æ­£æ˜¯è¿™ä¸ª &lt;code&gt;luaC_barrier&lt;/code&gt;ï¼Œä¿è¯äº†å¢é‡ GC çš„æ­£ç¡®æ€§ã€‚å®ƒå°±åƒä¸€ä¸ªç›‘è§†å™¨ï¼Œæ‹¦æˆªäº†æ‰€æœ‰çš„èµ‹å€¼æ“ä½œã€‚&lt;/p&gt;
&lt;h2 id="gcè§¦å‘çš„æ—¶æœº"&gt;GCè§¦å‘çš„æ—¶æœº
&lt;/h2&gt;&lt;p&gt;å‡è®¾æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;local i = 1234
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™è¡Œä»£ç ä¼šè§¦å‘ GC å—ï¼Ÿç­”æ¡ˆæ˜¯&lt;strong&gt;ä¸ä¼š&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ ¹æ® Lua çš„å†…å­˜æ¨¡å‹ï¼ˆå¦‚ä¸Šæ–‡ &lt;code&gt;TValue&lt;/code&gt; ç»“æ„æ‰€ç¤ºï¼‰ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å€¼ç±»å‹ï¼ˆValue Typesï¼‰&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;nil&lt;/code&gt;, &lt;code&gt;boolean&lt;/code&gt;, &lt;code&gt;number&lt;/code&gt; (integer/float)ã€‚è¿™äº›æ•°æ®ç›´æ¥å­˜æ”¾åœ¨ Lua æ ˆçš„ &lt;code&gt;TValue&lt;/code&gt; ç»“æ„ä½“ä¸­ã€‚å®ƒä»¬éšç€æ ˆå¸§çš„é”€æ¯è€Œè‡ªåŠ¨æ¶ˆå¤±ï¼Œ&lt;strong&gt;ä¸æ¶‰åŠå †å†…å­˜åˆ†é…&lt;/strong&gt;ï¼ˆmallocï¼‰ï¼Œå› æ­¤ä¸è®¡å…¥ GC çš„å€ºåŠ¡ï¼ˆGCdebtï¼‰ï¼Œè‡ªç„¶ä¹Ÿä¸ä¼šè§¦å‘ GC æ­¥è¿›ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¼•ç”¨ç±»å‹ï¼ˆReference Typesï¼‰&lt;/strong&gt;ï¼šå¦‚ &lt;code&gt;table&lt;/code&gt;, &lt;code&gt;function&lt;/code&gt;, &lt;code&gt;string&lt;/code&gt; (é•¿å­—ç¬¦ä¸²), &lt;code&gt;userdata&lt;/code&gt;ã€‚è¿™äº›å¯¹è±¡å­˜æ´»åœ¨å †ä¸Šï¼Œæ‰æ˜¯ GC ä¸»è¦â€œè¿½æ€â€çš„ç›®æ ‡ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;åœ¨ Lua è™šæ‹Ÿæœºæºç ä¸­ï¼Œå‡ ä¹æ‰€æœ‰æ¶‰åŠå†…å­˜åˆ†é…çš„æ“ä½œï¼ˆå¦‚ &lt;code&gt;lua_newtable&lt;/code&gt;, &lt;code&gt;lua_pushstring&lt;/code&gt;ï¼‰ä¹‹åï¼Œéƒ½ä¼šè°ƒç”¨ä¸€ä¸ªæ£€æŸ¥å®ï¼š&lt;strong&gt;&lt;code&gt;luaC_checkGC&lt;/code&gt;&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt;1
&lt;/span&gt;&lt;span class="lnt"&gt;2
&lt;/span&gt;&lt;span class="lnt"&gt;3
&lt;/span&gt;&lt;span class="lnt"&gt;4
&lt;/span&gt;&lt;span class="lnt"&gt;5
&lt;/span&gt;&lt;span class="lnt"&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;#define luaC_checkGC(L) { \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; if (G(L)-&amp;gt;GCdebt &amp;gt; 0) { \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; luaC_step(L); \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; } \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; condchangemem(L,pre,pos); \
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;GCdebt&lt;/code&gt; (GC å€ºåŠ¡)&lt;/strong&gt;ï¼šè¿™æ˜¯ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µã€‚æ¯å½“ä½ åˆ†é… 1 å­—èŠ‚å†…å­˜ï¼Œ&lt;code&gt;GCdebt&lt;/code&gt; å°±ä¼šå¢åŠ  1ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åˆ¤æ–­é€»è¾‘&lt;/strong&gt;ï¼šåªè¦â€œå€ºåŠ¡â€å¤§äº 0ï¼ŒLua å°±ä¼šè®¤ä¸ºâ€œå¦‚æœä½ åˆ¶é€ äº†åƒåœ¾ï¼ˆæˆ–è€…ç”³è¯·äº†æ–°å†…å­˜ï¼‰ï¼Œä½ å°±å¾—è´Ÿè´£æ¸…ç†ä¸€ç‚¹åƒåœ¾â€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;luaC_step&lt;/code&gt;&lt;/strong&gt;ï¼šè¿™å°±æ˜¯æ‰§è¡Œä¸€æ¬¡ GCâ€œæ­¥è¿›â€çš„å‡½æ•°ã€‚å®ƒä¸ä¼šè·‘å®Œæ•´ä¸ª GC æµç¨‹ï¼Œè€Œæ˜¯åªè·‘ä¸€å°æ­¥ï¼ˆå…·ä½“è·‘å¤šè¿œï¼Œç”± &lt;code&gt;stepmul&lt;/code&gt; å†³å®šï¼‰ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="æ§åˆ¶-gc-çš„é€Ÿç‡"&gt;æ§åˆ¶ GC çš„é€Ÿç‡
&lt;/h2&gt;&lt;p&gt;äº†è§£äº†åŸç†ï¼Œæˆ‘ä»¬å°±èƒ½çœ‹æ‡‚ &lt;code&gt;collectgarbage&lt;/code&gt; çš„ä¸¤ä¸ªå‚æ•°äº†ï¼š&lt;/p&gt;
&lt;h3 id="pause-æš‚åœç³»æ•°"&gt;&lt;code&gt;pause&lt;/code&gt; (æš‚åœç³»æ•°)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šGCçš„é—´æ­‡ç‡, å°† GCdebt è®¾ç½®ä¸ºä¸€ä¸ªå·¨å¤§çš„è´Ÿæ•°æ¥å®ç°çš„, é»˜è®¤å€¼200ï¼ˆå³ 200%ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘&lt;/strong&gt;ï¼šå¦‚æœå½“å‰å†…å­˜æ˜¯ 10MBï¼ŒGC ç»“æŸåå›æ”¶åˆ° 5MBã€‚é‚£ä¹ˆä¸‹ä¸€æ¬¡ GC å¯åŠ¨çš„é˜ˆå€¼æ˜¯ &lt;code&gt;5MB * 200% = 10MB&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å€¼è¶Šå°ï¼ŒGC è¶Šå‹¤å¿«ï¼Œå†…å­˜å ç”¨è¶Šä½ï¼Œä½† CPU æ¶ˆè€—è¶Šé«˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;static void setpause (global_State *g) {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; l_mem threshold, debt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; l_mem estimate = g-&amp;gt;GCestimate / 100; // è·å–ä¼°ç®—å†…å­˜
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; l_mem pause = (g-&amp;gt;gcpause != 0) ? g-&amp;gt;gcpause : 200; // é»˜è®¤ 200
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* è®¡ç®—æˆ‘ä»¬è¦ç­‰å¾…å¤šå°‘å†…å­˜åˆ†é… */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; threshold = (pause * estimate);
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* è®¾ç½®å€ºåŠ¡ = ä¼°ç®—å€¼ - é˜ˆå€¼
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; å› ä¸º é˜ˆå€¼ é€šå¸¸ &amp;gt; ä¼°ç®—å€¼ï¼Œæ‰€ä»¥è¿™é‡Œ debt æ˜¯è´Ÿæ•°
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; debt = gettotalbytes(g) - threshold;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; luaE_setdebt(g, debt);
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;h3 id="stepmul-æ­¥è¿›å€ç‡"&gt;&lt;code&gt;stepmul&lt;/code&gt; (æ­¥è¿›å€ç‡)
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å«ä¹‰&lt;/strong&gt;ï¼šæ§åˆ¶ GC æ‰«æçš„é€Ÿåº¦ã€‚é»˜è®¤å€¼ 200(200%)ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘&lt;/strong&gt;ï¼šåˆ†é…äº† 1 å­—èŠ‚å†…å­˜ï¼ˆå¢åŠ äº† 1 å­—èŠ‚å€ºåŠ¡ï¼‰,GC éœ€è¦æ‰§è¡Œç­‰åŒäº 2 å­—èŠ‚å†…å­˜çš„å·¥ä½œé‡ï¼Œæ‰èƒ½æŠŠè¿™ 1 å­—èŠ‚çš„å€ºåŠ¡â€œæŠµæ¶ˆâ€æ‰ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ å‘ç°å†…å­˜é£™å‡å¾—æ¯” GC å›æ”¶å¾—å¿«ï¼ˆAlloc &amp;gt; Freeï¼‰ï¼Œè¯´æ˜ GC è·‘æ…¢äº†ï¼Œéœ€è¦&lt;strong&gt;è°ƒå¤§&lt;/strong&gt; &lt;code&gt;stepmul&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;å¦‚æœä½ å‘ç°æ¸¸æˆæ˜æ˜¾å¡é¡¿ï¼Œå¯èƒ½æ˜¯ GC ä¸€æ¬¡æ­¥è¿›å ç”¨ CPU å¤ªå¤šï¼Œå°è¯•&lt;strong&gt;è°ƒå°&lt;/strong&gt; &lt;code&gt;stepmul&lt;/code&gt; è®©åˆ‡ç‰‡æ›´ç»†ã€‚&lt;/li&gt;
&lt;/ul&gt;</description></item><item><title>Lua Table</title><link>https://WeissGoat.github.io/WBlog/p/lua-table/</link><pubDate>Mon, 05 Feb 2024 18:00:00 +0800</pubDate><guid>https://WeissGoat.github.io/WBlog/p/lua-table/</guid><description>&lt;h2 id="æ ¸å¿ƒæ•°æ®ç»“æ„"&gt;æ ¸å¿ƒæ•°æ®ç»“æ„
&lt;/h2&gt;&lt;p&gt;Lua Table çš„é«˜æ•ˆç”±å…¶åº•å±‚çš„ &lt;code&gt;struct Table&lt;/code&gt; å†³å®šã€‚ä»æºç ä¸­æˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°ï¼Œå®ƒå¹¶éå•çº¯çš„å“ˆå¸Œè¡¨ï¼Œè€Œæ˜¯&lt;strong&gt;æ•°ç»„&lt;/strong&gt;ä¸&lt;strong&gt;å“ˆå¸Œè¡¨&lt;/strong&gt;çš„ç»“åˆä½“ã€‚&lt;/p&gt;
&lt;h3 id="table-ç»“æ„ä½“å®šä¹‰"&gt;Table ç»“æ„ä½“å®šä¹‰
&lt;/h3&gt;&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;typedef struct Table {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; CommonHeader;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; lu_byte flags; /* 1&amp;lt;&amp;lt;p means tagmethod(p) is not present (å…ƒæ–¹æ³•ç¼“å­˜) */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; lu_byte lsizenode; /* å“ˆå¸Œè¡¨é•¿åº¦çš„å¯¹æ•°ï¼Œå³ hash_size = 2^lsizenode */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; unsigned int alimit;/* æ•°ç»„éƒ¨åˆ†çš„â€œé€»è¾‘â€å¤§å° (å³ sizearray) */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; TValue *array; /* æ•°ç»„éƒ¨åˆ†æŒ‡é’ˆ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Node *node; /* å“ˆå¸Œæ¡¶æ•°ç»„èµ·å§‹æŒ‡é’ˆ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Node *lastfree; /* æŒ‡å‘å“ˆå¸Œéƒ¨åˆ†æœ€åä¸€ä¸ªç©ºé—²ä½ç½®ï¼Œç”¨äºå¿«é€Ÿæ’å…¥ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; struct Table *metatable; /* å…ƒè¡¨ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; GCObject *gclist;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;} Table;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;è®¾è®¡è§£è¯»ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åŒé‡å­˜å‚¨&lt;/strong&gt;ï¼š&lt;code&gt;array&lt;/code&gt; æŒ‡é’ˆç®¡ç†è¿ç»­å†…å­˜ï¼Œç”¨äºå­˜æ”¾æ•´æ•°é”®ï¼ˆ1..nï¼‰ï¼›&lt;code&gt;node&lt;/code&gt; æŒ‡é’ˆç®¡ç†å“ˆå¸Œæ¡¶ï¼Œç”¨äºå­˜æ”¾å…¶ä»–é”®æˆ–ç¦»æ•£çš„æ•´æ•°é”®ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç©ºé—´æ¢æ—¶é—´&lt;/strong&gt;ï¼š&lt;code&gt;lastfree&lt;/code&gt; æŒ‡é’ˆçš„è®¾è®¡éå¸¸å·§å¦™ï¼Œå®ƒé¿å…äº†æ¯æ¬¡æ’å…¥æ—¶çº¿æ€§æ‰«æå¯»æ‰¾ç©ºä½ï¼Œå°†æŸ¥æ‰¾ç©ºé—²ä½ç½®çš„å¤æ‚åº¦å°½é‡é™ä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;lsizenode&lt;/strong&gt;ï¼šå“ˆå¸Œè¡¨çš„å¤§å°å§‹ç»ˆä¿æŒä¸º 2 çš„å¹‚æ¬¡ï¼Œè¿™é‡Œå­˜å‚¨çš„æ˜¯å¹‚æ¬¡ï¼ˆlog2ï¼‰ï¼Œçœå»äº†å­˜å‚¨å®é™…å¤§å°çš„å†…å­˜ï¼Œè®¡ç®—æ—¶ä½ç§»å³å¯ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="èŠ‚ç‚¹nodeä¸é”®key"&gt;èŠ‚ç‚¹ï¼ˆNodeï¼‰ä¸é”®ï¼ˆKeyï¼‰
&lt;/h3&gt;&lt;p&gt;å“ˆå¸Œéƒ¨åˆ†çš„èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;typedef union TKey {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; struct {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; TValuefields;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; struct Node *next; /* é“¾è¡¨æ³•è§£å†³å†²çªï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå†²çªèŠ‚ç‚¹ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; } nk;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; TValue tvk;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;} TKey;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;typedef struct Node {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; TValue i_val;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; TKey i_key;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;} Node;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;è¿™é‡Œ &lt;code&gt;Node&lt;/code&gt; åŒ…å«äº† Key å’Œ Valueã€‚Key æ˜¯ä¸€ä¸ª unionï¼Œä¸ºäº†å†…å­˜å¯¹é½å’Œè®¿é—®æ•ˆç‡ï¼Œå½“å‘ç”Ÿå“ˆå¸Œå†²çªæ—¶ï¼Œé€šè¿‡ &lt;code&gt;next&lt;/code&gt; æŒ‡é’ˆå½¢æˆå•å‘é“¾è¡¨ã€‚&lt;/p&gt;
&lt;h2 id="é”®çš„å½’å±æ•°ç»„è¿˜æ˜¯å“ˆå¸Œ"&gt;é”®çš„å½’å±ï¼šæ•°ç»„è¿˜æ˜¯å“ˆå¸Œï¼Ÿ
&lt;/h2&gt;&lt;p&gt;å½“æˆ‘ä»¬æ‰§è¡Œ &lt;code&gt;t[k] = v&lt;/code&gt; æ—¶ï¼ŒLua æ˜¯å¦‚ä½•å†³å®šæŠŠæ•°æ®å­˜åœ¨ &lt;code&gt;array&lt;/code&gt; è¿˜æ˜¯ &lt;code&gt;node&lt;/code&gt; é‡Œçš„ï¼Ÿ&lt;/p&gt;
&lt;h3 id="æ•´æ•°é”®çš„vip-é€šé“"&gt;æ•´æ•°é”®çš„â€œVIP é€šé“â€
&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ­£æ•´æ•°é”®ï¼ˆå¦‚ &lt;code&gt;t[1]&lt;/code&gt;, &lt;code&gt;t[100]&lt;/code&gt;ï¼‰ä¼šä¼˜å…ˆå°è¯•æ”¾å…¥æ•°ç»„éƒ¨åˆ†ã€‚ä½†å¹¶éæ‰€æœ‰æ•´æ•°éƒ½ä¼šè¿›å…¥æ•°ç»„ï¼Œå¿…é¡»æ»¡è¶³&lt;strong&gt;åˆ©ç”¨ç‡åŸåˆ™&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;æ ¸å¿ƒè§„åˆ™&lt;/strong&gt;ï¼šåŒ…å«å½“å‰ key çš„åŒºé—´ $[1, 2^n]$ å†…ï¼Œéç©ºå…ƒç´ æ•°é‡å¿…é¡»å¤§äº $2^{n-1}$ï¼ˆå³åˆ©ç”¨ç‡ &amp;gt; 50%ï¼‰ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;æºç  (&lt;code&gt;ltable.c&lt;/code&gt;)&lt;/strong&gt;ï¼š Lua é€šè¿‡ &lt;code&gt;computesizes&lt;/code&gt; å‡½æ•°æ¥è®¡ç®—æ•°ç»„çš„æœ€ä½³å¤§å°ï¼Œä»£ç æ¸…æ™°åœ°å±•ç¤ºäº†â€œ&amp;gt; 50%â€çš„åˆ¤æ–­é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;/* è®¡ç®—æ•°ç»„éƒ¨åˆ†çš„æœ€ä½³å¤§å° */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;static unsigned int computesizes (unsigned int nums[], unsigned int *narray) {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; int i;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; unsigned int twotoi; /* 2^i */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; unsigned int a = 0; /* ç»Ÿè®¡å°äº 2^i çš„å…ƒç´ ä¸ªæ•° */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; unsigned int na = 0; /* æœ€ç»ˆè½å…¥æ•°ç»„éƒ¨åˆ†çš„å…ƒç´ ä¸ªæ•° */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; unsigned int optimal = 0; /* æœ€ä½³æ•°ç»„å¤§å° */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; /* å¾ªç¯éå†æ¯ä¸ª 2^i åŒºé—´ */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; for (i = 0, twotoi = 1; twotoi/2 &amp;lt; *narray; i++, twotoi *= 2) {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; if (nums[i] &amp;gt; 0) {
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; a += nums[i];
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; if (a &amp;gt; twotoi/2) { /* æ ¸å¿ƒåˆ¤æ–­ï¼šåˆ©ç”¨ç‡ &amp;gt; 50% */
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; optimal = twotoi;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; na = a;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; *narray = optimal;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; return na;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;p&gt;&lt;strong&gt;ä¸¾ä¸ªä¾‹å­&lt;/strong&gt;ï¼š å¦‚æœä½ åˆ›å»ºäº†ä¸€ä¸ªè¡¨ &lt;code&gt;t = {[1]=1, [1000]=1}&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;1&lt;/code&gt; åœ¨æ•°ç»„éƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;1000&lt;/code&gt; è™½ç„¶æ˜¯æ•´æ•°ï¼Œä½†å¦‚æœå¼ºè¡Œæ‰©å®¹æ•°ç»„åˆ° 1000ï¼Œä¸­é—´ä¼šæœ‰ 998 ä¸ªç©ºæ´ï¼Œä¸æ»¡è¶³ &lt;code&gt;a &amp;gt; twotoi/2&lt;/code&gt;ã€‚å› æ­¤ï¼Œ&lt;code&gt;1000&lt;/code&gt; ä¼šè¢«å½“ä½œæ™®é€š Key æ‰”è¿›å“ˆå¸Œéƒ¨åˆ†ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="å“ˆå¸Œéƒ¨åˆ†çš„æ”¶å®¹æ‰€"&gt;å“ˆå¸Œéƒ¨åˆ†çš„â€œæ”¶å®¹æ‰€â€
&lt;/h3&gt;&lt;p&gt;ä»¥ä¸‹æƒ…å†µ Key ä¼šè¿›å…¥å“ˆå¸Œè¡¨ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;éæ•´æ•°ç±»å‹&lt;/strong&gt;ï¼šå­—ç¬¦ä¸²ã€Tableã€Userdata ç­‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è¶Šç•Œçš„æ•´æ•°&lt;/strong&gt;ï¼šæ•°å€¼æå¤§ï¼Œæˆ–è€…åƒä¸Šé¢æåˆ°çš„è¿‡äºç¨€ç–çš„æ•´æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;è´Ÿæ•°&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="å†²çªè§£å†³brents-method-çš„å˜ç§"&gt;å†²çªè§£å†³ï¼šBrent&amp;rsquo;s Method çš„å˜ç§
&lt;/h2&gt;&lt;p&gt;è¿™æ˜¯ Lua Table å®ç°ä¸­æœ€â€œéªšâ€çš„æ“ä½œä¹‹ä¸€ã€‚&lt;/p&gt;
&lt;p&gt;é€šå¸¸å“ˆå¸Œè¡¨è§£å†³å†²çªç”¨çš„æ˜¯&lt;strong&gt;å¼€é“¾æ³•ï¼ˆOpen Addressing with Chainingï¼‰&lt;/strong&gt;ï¼Œä½† Lua ä¸ºäº†èŠ‚çœå†…å­˜ï¼Œå¹¶æ²¡æœ‰åœ¨è¿™ä¸ªé“¾è¡¨ä¹‹å¤–å•ç‹¬åˆ†é…å†…å­˜ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨å“ˆå¸Œæ¡¶æ•°ç»„ä¸­æœªè¢«ä½¿ç”¨çš„æ§½ä½ã€‚&lt;/p&gt;
&lt;h3 id="æ’å…¥é€»è¾‘insert"&gt;æ’å…¥é€»è¾‘ï¼ˆInsertï¼‰
&lt;/h3&gt;&lt;p&gt;å½“æˆ‘ä»¬è¦æ’å…¥ä¸€ä¸ªæ–°çš„ Key (&lt;code&gt;new_key&lt;/code&gt;)ï¼Œç®—å‡ºå®ƒåº”è¯¥åœ¨çš„ä½ç½® &lt;code&gt;main_pos&lt;/code&gt;ï¼Œå´å‘ç°é‚£é‡Œå·²ç»æœ‰â€œäººâ€äº† (&lt;code&gt;old_node&lt;/code&gt;)ï¼ŒLua ä¼šæ ¹æ® &lt;code&gt;old_node&lt;/code&gt; çš„èº«ä»½é‡‡å–ä¸åŒç­–ç•¥ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;æºç  (&lt;code&gt;luaH_newkey&lt;/code&gt;)&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;span class="lnt"&gt;21
&lt;/span&gt;&lt;span class="lnt"&gt;22
&lt;/span&gt;&lt;span class="lnt"&gt;23
&lt;/span&gt;&lt;span class="lnt"&gt;24
&lt;/span&gt;&lt;span class="lnt"&gt;25
&lt;/span&gt;&lt;span class="lnt"&gt;26
&lt;/span&gt;&lt;span class="lnt"&gt;27
&lt;/span&gt;&lt;span class="lnt"&gt;28
&lt;/span&gt;&lt;span class="lnt"&gt;29
&lt;/span&gt;&lt;span class="lnt"&gt;30
&lt;/span&gt;&lt;span class="lnt"&gt;31
&lt;/span&gt;&lt;span class="lnt"&gt;32
&lt;/span&gt;&lt;span class="lnt"&gt;33
&lt;/span&gt;&lt;span class="lnt"&gt;34
&lt;/span&gt;&lt;span class="lnt"&gt;35
&lt;/span&gt;&lt;span class="lnt"&gt;36
&lt;/span&gt;&lt;span class="lnt"&gt;37
&lt;/span&gt;&lt;span class="lnt"&gt;38
&lt;/span&gt;&lt;span class="lnt"&gt;39
&lt;/span&gt;&lt;span class="lnt"&gt;40
&lt;/span&gt;&lt;span class="lnt"&gt;41
&lt;/span&gt;&lt;span class="lnt"&gt;42
&lt;/span&gt;&lt;span class="lnt"&gt;43
&lt;/span&gt;&lt;span class="lnt"&gt;44
&lt;/span&gt;&lt;span class="lnt"&gt;45
&lt;/span&gt;&lt;span class="lnt"&gt;46
&lt;/span&gt;&lt;span class="lnt"&gt;47
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-gdscript3" data-lang="gdscript3"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ’å…¥æ–°é”®çš„æ ¸å¿ƒé€»è¾‘&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="err"&gt;ç®€åŒ–ç‰ˆ&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="n"&gt;TValue&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;luaH_newkey&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lua_State&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;Table&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;TValue&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="ne"&gt;Node&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttisnil&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="n"&gt;luaG_runerror&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;#34;table index is nil&amp;#34;&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt; &lt;span class="err"&gt;è®¡ç®—ä¸»ä½ç½®&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Main&lt;/span&gt; &lt;span class="n"&gt;Position&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mainposition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="mf"&gt;2.&lt;/span&gt; &lt;span class="err"&gt;å¦‚æœä¸»ä½ç½®å·²è¢«å ç”¨&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="o"&gt;!&lt;/span&gt;&lt;span class="n"&gt;ttisnil&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;||&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;dummynode&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="ne"&gt;Node&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;è·å–ç©ºé—²ä½ç½®&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;lastfree&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="ne"&gt;Node&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;getfreepos&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;NULL&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ²¡ä½ç½®äº†ï¼Ÿæ‰©å®¹&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;rehash&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;luaH_set&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;è®¡ç®—å ä½è€…&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;old_node&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;&lt;span class="err"&gt;åŸæœ¬è¯¥åœ¨çš„ä¸»ä½ç½®&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;othern&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;mainposition&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;keyfromval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="n"&gt;Case&lt;/span&gt; &lt;span class="n"&gt;A&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;é¸ å é¹Šå·¢&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;æŠŠ&lt;/span&gt; &lt;span class="n"&gt;old_node&lt;/span&gt; &lt;span class="err"&gt;èµ¶åˆ°&lt;/span&gt; &lt;span class="n"&gt;free&lt;/span&gt; &lt;span class="n"&gt;pos&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;while&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;othern&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ‰¾åˆ°æŒ‡å‘&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="err"&gt;çš„å‰é©±&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;othern&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cast_int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;othern&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;ä¿®æ­£é“¾è¡¨æŒ‡å‘æ–°ä½ç½®&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ¬è¿æ•°æ®&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;è…¾å‡º&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="err"&gt;ç»™æ–°é”®ï¼Œå› ä¸º&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="err"&gt;æ˜¯æ–°é”®çš„ä¸»ä½ç½®&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;setnilvalue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;));&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="n"&gt;Case&lt;/span&gt; &lt;span class="n"&gt;B&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="err"&gt;åŸä½æ°‘å†²çª&lt;/span&gt; &lt;span class="o"&gt;-&amp;gt;&lt;/span&gt; &lt;span class="err"&gt;æ–°é”®åªèƒ½å»&lt;/span&gt; &lt;span class="n"&gt;free&lt;/span&gt; &lt;span class="n"&gt;pos&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;!=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cast_int&lt;/span&gt;&lt;span class="p"&gt;((&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="o"&gt;+&lt;/span&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;å¤´æ’æ³•ï¼šé“¾åœ¨&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="err"&gt;åé¢&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;cast_int&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;f&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;mp&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;setnodekey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;L&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;i_key&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;gval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;mp&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æƒ…å†µ Aï¼šé¸ å é¹Šå·¢&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;old_node&lt;/code&gt; æ˜¯è¢«æŒ¤åˆ°è¿™é‡Œçš„ï¼ˆå³ &lt;code&gt;othern != mp&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;ï¼šLua æŠŠå®ƒæŒªåˆ° &lt;code&gt;lastfree&lt;/code&gt;ï¼ŒæŠŠ &lt;code&gt;main_pos&lt;/code&gt; æŠ¢å›æ¥ç»™ &lt;code&gt;new_key&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç›®çš„&lt;/strong&gt;ï¼šä¿è¯ &lt;code&gt;new_key&lt;/code&gt; è¿™ç§â€œåŸä½æ°‘â€èƒ½ç›´æ¥æ‰¾åˆ°ä½ç½®ï¼Œå‡å°‘åç»­æŸ¥æ‰¾çš„å¼€é”€ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æƒ…å†µ Bï¼šåŸä½æ°‘å†²çª&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;å¦‚æœ &lt;code&gt;old_node&lt;/code&gt; æœ¬æ¥å°±è¯¥å¾…åœ¨è¿™é‡Œã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œ&lt;/strong&gt;ï¼š&lt;code&gt;new_key&lt;/code&gt; å» &lt;code&gt;lastfree&lt;/code&gt;ï¼Œå¹¶é“¾æ¥åœ¨ &lt;code&gt;old_node&lt;/code&gt; åé¢ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™ç§æœºåˆ¶è¢«ç§°ä¸º &lt;strong&gt;Chained Scatter Table&lt;/strong&gt;ï¼Œå®ƒå……åˆ†åˆ©ç”¨äº†æ•°ç»„ç©ºé—´ï¼Œé¿å…äº†ç”±äºå¤§é‡å¾®å°å¯¹è±¡åˆ†é…å¯¼è‡´çš„å†…å­˜ç¢ç‰‡ã€‚&lt;/p&gt;
&lt;h2 id="åŠ¨æ€æ‰©å®¹rehash-çš„è‰ºæœ¯"&gt;åŠ¨æ€æ‰©å®¹ï¼šRehash çš„è‰ºæœ¯
&lt;/h2&gt;&lt;p&gt;Table çš„ç©ºé—´ä¸æ˜¯å›ºå®šçš„ã€‚å½“ç©ºé—´ä¸è¶³æˆ–åˆ©ç”¨ç‡å¤±è¡¡æ—¶ï¼Œä¼šè§¦å‘ Rehashã€‚&lt;/p&gt;
&lt;h3 id="è§¦å‘æ—¶æœº"&gt;è§¦å‘æ—¶æœº
&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ’å…¥æ–°é”®ä¸”ç©ºé—´å·²æ»¡&lt;/strong&gt;ï¼šå½“æˆ‘ä»¬èµ‹å€¼ä¸€ä¸ªæ–°é”®ï¼Œè€Œ Table æ—¢æ²¡æœ‰æ•°ç»„ç©ºé—´ï¼Œä¹Ÿæ²¡æœ‰å“ˆå¸Œç©ºä½æ—¶ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ³¨æ„&lt;/strong&gt;ï¼šå°†æŸä¸ª Key ç½®ä¸º &lt;code&gt;nil&lt;/code&gt; &lt;strong&gt;ä¸ä¼š&lt;/strong&gt;ç«‹å³è§¦å‘ Rehashï¼ˆä¸ºäº†é˜²æ­¢é¢‘ç¹çš„å†…å­˜æŠ–åŠ¨ï¼‰ã€‚åªæœ‰åœ¨ç©ºé—´ä¸è¶³éœ€è¦é‡æ–°è¯„ä¼°æ—¶ï¼Œæ‰ä¼šå›æ”¶ &lt;code&gt;nil&lt;/code&gt; å ç”¨çš„ç©ºé—´ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="rehash-çš„ä¸‰éƒ¨æ›²"&gt;Rehash çš„ä¸‰éƒ¨æ›²
&lt;/h3&gt;&lt;p&gt;Rehash æ˜¯ä¸€ä¸ªç›¸å¯¹æ˜‚è´µçš„æ“ä½œï¼ŒLua å¿…é¡»ä¸€æ¬¡æ€§é‡æ–°è®¡ç®—æ•°ç»„å’Œå“ˆå¸Œä¸¤éƒ¨åˆ†çš„æœ€ä½³å¤§å°ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿè®¡ï¼ˆCountingï¼‰&lt;/strong&gt;ï¼š éå†æ•´ä¸ª Tableï¼ˆåŒ…æ‹¬ç°æœ‰çš„ Array å’Œ Hash éƒ¨åˆ†ï¼‰ï¼Œç»Ÿè®¡æ‰€æœ‰æ­£æ•´æ•°é”®çš„æ•°é‡ï¼Œå¹¶æŒ‰ $2^n$ çš„åŒºé—´ï¼ˆ1-2, 3-4, 5-8&amp;hellip;ï¼‰è¿›è¡Œåˆ†æ¡¶ç»Ÿè®¡ã€‚åŒæ—¶ç»Ÿè®¡éæ•´æ•°é”®çš„æ€»æ•°ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å®šç•Œï¼ˆSizingï¼‰&lt;/strong&gt;ï¼š è®¡ç®—æ•°ç»„éƒ¨åˆ†çš„æœ€ä½³å¤§å° &lt;code&gt;sizearray&lt;/code&gt;ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç®—æ³•ï¼šæ‰¾åˆ°æœ€å¤§çš„ $N$ï¼ˆ$2$ çš„å¹‚ï¼‰ï¼Œä½¿å¾— $[1, N]$ åŒºé—´å†…çš„æ•´æ•°é”®æ•°é‡ $\ge N/2$ã€‚&lt;/li&gt;
&lt;li&gt;å‡¡æ˜¯å°äºç­‰äº $N$ çš„æ•´æ•°æ”¾å…¥æ–°æ•°ç»„ï¼Œå…¶ä½™æ”¾å…¥æ–°å“ˆå¸Œè¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start="3"&gt;
&lt;li&gt;&lt;strong&gt;æ¬è¿ï¼ˆRelocationï¼‰&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;ç”³è¯·æ–°çš„ Array å’Œ Hash å†…å­˜å—ã€‚&lt;/li&gt;
&lt;li&gt;å°†æ•°æ®æ¬è¿è¿‡å»ï¼ˆé‡æ–°è®¡ç®—å“ˆå¸Œå€¼ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;é‡Šæ”¾æ—§å†…å­˜ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;è¿™è§£é‡Šäº†ä¸ºä»€ä¹ˆ Lua Table æ—¢èƒ½åƒ C æ•°ç»„ä¸€æ ·ç´§å‡‘é«˜æ•ˆï¼Œåˆèƒ½åƒ Python Dict ä¸€æ ·çµæ´»ã€‚&lt;/p&gt;
&lt;h2 id="è¿­ä»£å™¨çš„ç§˜å¯†pairs-ä¸-ipairs"&gt;è¿­ä»£å™¨çš„ç§˜å¯†ï¼špairs ä¸ ipairs
&lt;/h2&gt;&lt;p&gt;æˆ‘ä»¬åœ¨å†™ Lua æ—¶å¸¸ç”¨çš„ä¸¤ç§éå†æ–¹å¼ï¼Œå…¶åº•å±‚æ€§èƒ½å·®å¼‚å·¨å¤§ã€‚&lt;/p&gt;
&lt;h3 id="ipairsåºåˆ—ä¸“ç”¨"&gt;ipairsï¼šåºåˆ—ä¸“ç”¨
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;ipairs&lt;/code&gt; æ˜¯ä¸º**åºåˆ—ï¼ˆSequenceï¼‰**é‡èº«å®šåšçš„ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é€»è¾‘&lt;/strong&gt;ï¼šç»´æŠ¤ä¸€ä¸ªå†…éƒ¨è®¡æ•°å™¨ &lt;code&gt;i&lt;/code&gt;ï¼Œä» 1 å¼€å§‹é€’å¢ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¯»å€&lt;/strong&gt;ï¼šLua å†…éƒ¨ä¼šå…ˆåˆ¤æ–­ &lt;code&gt;i&lt;/code&gt; æ˜¯å¦åœ¨ &lt;code&gt;array&lt;/code&gt; çš„èŒƒå›´å†…ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;æºç  (&lt;code&gt;luaH_getint&lt;/code&gt;)&lt;/strong&gt;ï¼š è¿™æ˜¯æ•´æ•°æŸ¥æ‰¾çš„å…¥å£å‡½æ•°ï¼Œæ¸…æ™°å±•ç¤ºäº†â€œå…ˆæŸ¥æ•°ç»„ï¼Œå†æŸ¥å“ˆå¸Œâ€çš„é€»è¾‘ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;div class="chroma"&gt;
&lt;table class="lntable"&gt;&lt;tr&gt;&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code&gt;&lt;span class="lnt"&gt; 1
&lt;/span&gt;&lt;span class="lnt"&gt; 2
&lt;/span&gt;&lt;span class="lnt"&gt; 3
&lt;/span&gt;&lt;span class="lnt"&gt; 4
&lt;/span&gt;&lt;span class="lnt"&gt; 5
&lt;/span&gt;&lt;span class="lnt"&gt; 6
&lt;/span&gt;&lt;span class="lnt"&gt; 7
&lt;/span&gt;&lt;span class="lnt"&gt; 8
&lt;/span&gt;&lt;span class="lnt"&gt; 9
&lt;/span&gt;&lt;span class="lnt"&gt;10
&lt;/span&gt;&lt;span class="lnt"&gt;11
&lt;/span&gt;&lt;span class="lnt"&gt;12
&lt;/span&gt;&lt;span class="lnt"&gt;13
&lt;/span&gt;&lt;span class="lnt"&gt;14
&lt;/span&gt;&lt;span class="lnt"&gt;15
&lt;/span&gt;&lt;span class="lnt"&gt;16
&lt;/span&gt;&lt;span class="lnt"&gt;17
&lt;/span&gt;&lt;span class="lnt"&gt;18
&lt;/span&gt;&lt;span class="lnt"&gt;19
&lt;/span&gt;&lt;span class="lnt"&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class="lntd"&gt;
&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-gdscript3" data-lang="gdscript3"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="k"&gt;const&lt;/span&gt; &lt;span class="n"&gt;TValue&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;luaH_getint&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Table&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;lua_Integer&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="mf"&gt;1.&lt;/span&gt; &lt;span class="err"&gt;æ•°ç»„éƒ¨åˆ†å¿«é€ŸæŸ¥æ‰¾&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Fast&lt;/span&gt; &lt;span class="ne"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;è¿™é‡Œçš„&lt;/span&gt; &lt;span class="n"&gt;alimit&lt;/span&gt; &lt;span class="err"&gt;å°±æ˜¯æ•°ç»„çš„é€»è¾‘å¤§å°&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;l_castS2U&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt; &lt;span class="o"&gt;&amp;lt;&lt;/span&gt; &lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;alimit&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="o"&gt;-&amp;gt;&lt;/span&gt;&lt;span class="n"&gt;array&lt;/span&gt;&lt;span class="p"&gt;[&lt;/span&gt;&lt;span class="n"&gt;key&lt;/span&gt; &lt;span class="o"&gt;-&lt;/span&gt; &lt;span class="mi"&gt;1&lt;/span&gt;&lt;span class="p"&gt;];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="mf"&gt;2.&lt;/span&gt; &lt;span class="err"&gt;å“ˆå¸Œéƒ¨åˆ†æŸ¥æ‰¾&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;Slow&lt;/span&gt; &lt;span class="ne"&gt;Path&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="ne"&gt;Node&lt;/span&gt; &lt;span class="o"&gt;*&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;hashint&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;t&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;for&lt;/span&gt; &lt;span class="p"&gt;(;;)&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;ttisinteger&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gkey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class="n"&gt;ivalue&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;gkey&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;))&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="n"&gt;key&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;gval&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ‰¾åˆ°äº†&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;else&lt;/span&gt; &lt;span class="p"&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="ne"&gt;int&lt;/span&gt; &lt;span class="n"&gt;nx&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;gnext&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;n&lt;/span&gt;&lt;span class="p"&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;if&lt;/span&gt; &lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;nx&lt;/span&gt; &lt;span class="o"&gt;==&lt;/span&gt; &lt;span class="mi"&gt;0&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;break&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="n"&gt;n&lt;/span&gt; &lt;span class="o"&gt;+=&lt;/span&gt; &lt;span class="n"&gt;nx&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt; &lt;span class="o"&gt;/*&lt;/span&gt; &lt;span class="err"&gt;æ²¿ç€å†²çªé“¾æŸ¥æ‰¾&lt;/span&gt; &lt;span class="o"&gt;*/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="k"&gt;return&lt;/span&gt; &lt;span class="n"&gt;luaO_nilobject&lt;/span&gt;&lt;span class="p"&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; &lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;&lt;span class="p"&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;åœ¨èŒƒå›´å†…&lt;/strong&gt;ï¼šç›´æ¥é€šè¿‡æŒ‡é’ˆåç§» &lt;code&gt;array[i]&lt;/code&gt; è¯»å–ï¼Œè¿™å‡ ä¹å°±æ˜¯ C è¯­è¨€è®¿é—®æ•°ç»„çš„é€Ÿåº¦ï¼Œ&lt;strong&gt;æå¿«&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ä¸åœ¨èŒƒå›´å†…&lt;/strong&gt;ï¼šæ‰å»æŸ¥ Hash è¡¨ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="pairså…¨é‡éå†"&gt;pairsï¼šå…¨é‡éå†
&lt;/h3&gt;&lt;p&gt;&lt;code&gt;pairs&lt;/code&gt; ä½¿ç”¨çš„æ˜¯ &lt;code&gt;lua_next&lt;/code&gt; å‡½æ•°ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æµç¨‹&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;å…ˆéå†æ•°ç»„éƒ¨åˆ†&lt;/strong&gt;ï¼šä»ä¸‹æ ‡ 0 åˆ° &lt;code&gt;sizearray&lt;/code&gt; çº¿æ€§æ‰«æã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å†éå†å“ˆå¸Œéƒ¨åˆ†&lt;/strong&gt;ï¼šä»å“ˆå¸Œæ¡¶çš„ç¬¬ä¸€ä¸ªä½ç½®æ‰«æåˆ°æœ€åä¸€ä¸ªä½ç½®ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;é¡ºåºé—®é¢˜&lt;/strong&gt;ï¼š&lt;/li&gt;
&lt;li&gt;å¯¹äº&lt;strong&gt;çº¯æ•°ç»„&lt;/strong&gt;è¡¨ï¼ˆå¦‚ &lt;code&gt;{10, 20, 30}&lt;/code&gt;ï¼‰ï¼Œå› ä¸ºåªæ‰«ææ•°ç»„éƒ¨åˆ†ï¼Œè¾“å‡ºçœ‹èµ·æ¥æ˜¯æœ‰åºçš„ã€‚&lt;/li&gt;
&lt;li&gt;ä¸€æ—¦æ¶‰åŠå“ˆå¸Œéƒ¨åˆ†ï¼Œé¡ºåºå°±æ˜¯&lt;strong&gt;ä¹±åº&lt;/strong&gt;çš„ã€‚è¿™æ˜¯å› ä¸º Key åœ¨å“ˆå¸Œè¡¨ä¸­çš„ç‰©ç†ä½ç½®å–å†³äº Hash ç®—æ³•å’Œå†²çªæ—¶çš„æ’å…¥é¡ºåºï¼Œä¸é€»è¾‘é¡ºåºæ— å…³ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;ä¸è¦ä¾èµ– &lt;code&gt;pairs&lt;/code&gt; çš„éå†é¡ºåºï¼Œé™¤éä½ ç¡®è®¤è¡¨æ˜¯çº¯æ•°ç»„ä¸”å°šæœªå‘ç”Ÿè¿‡å¤æ‚çš„ Rehashã€‚&lt;/p&gt;
&lt;/blockquote&gt;</description></item><item><title>hello world</title><link>https://WeissGoat.github.io/WBlog/p/hello-world/</link><pubDate>Mon, 29 Jan 2024 00:00:00 +0000</pubDate><guid>https://WeissGoat.github.io/WBlog/p/hello-world/</guid><description>&lt;p&gt;å¾ˆå¹¸è¿ç”Ÿæ´»åœ¨ä¸€ä¸ªæŠ€æœ¯çˆ†ç‚¸çš„æ—¶ä»£, æ„Ÿè§‰æœªæ¥å……æ»¡ç€å¯èƒ½æ€§&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œå±•ç¤ºæˆ‘çš„ç”Ÿæ´», æˆ‘çš„æ€è€ƒ, æˆ‘çš„æˆé•¿&lt;/p&gt;</description></item><item><title>å…³äº</title><link>https://WeissGoat.github.io/WBlog/%E5%85%B3%E4%BA%8E/</link><pubDate>Tue, 26 Jan 2021 00:00:00 +0000</pubDate><guid>https://WeissGoat.github.io/WBlog/%E5%85%B3%E4%BA%8E/</guid><description>&lt;p&gt;å¾ˆå¹¸è¿ç”Ÿæ´»åœ¨ä¸€ä¸ªæŠ€æœ¯çˆ†ç‚¸çš„æ—¶ä»£, æ„Ÿè§‰æœªæ¥å……æ»¡ç€å¯èƒ½æ€§&lt;/p&gt;
&lt;p&gt;åœ¨è¿™é‡Œå±•ç¤ºæˆ‘çš„ç”Ÿæ´», æˆ‘çš„æ€è€ƒ, æˆ‘çš„æˆé•¿&lt;/p&gt;</description></item><item><title>å½’æ¡£</title><link>https://WeissGoat.github.io/WBlog/archives/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://WeissGoat.github.io/WBlog/archives/</guid><description/></item><item><title>æœç´¢</title><link>https://WeissGoat.github.io/WBlog/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://WeissGoat.github.io/WBlog/search/</guid><description/></item></channel></rss>